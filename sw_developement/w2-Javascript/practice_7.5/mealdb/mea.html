<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Meal Finder</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>

<body>
  <header>
    <h1>Welcome to my Meal Finder!</h1>
  </header>
  <main class="container">

    <section>
      <div class="mb-3 w-50">
        <input id="search-field" type="text" class="form-control" placeholder="Search for meals by first letter">
        <div id="btn-search" class="btn btn-primary">Search</div>
      </div>
    </section>

    <!-- display search result -->
    <section>
      <div id="meals-container" class="row row-cols-1 row-cols-md-3 g-4">
      </div>
      <div id="no-found-message" class="mt-4 d-none">
        <h3 class="text-warning">No meals found! Please try a new search</h3>
      </div>
      <div id="show-all" class="text-center d-none">
        <div id="btn-show-all" class="btn btn-primary">Show All</div>
      </div>
    </section>

    <!-- Loader -->
    <section id="loader" class="d-none">
      <div style="height: 200px;" class="d-flex justify-content-center align-items-center">
        <div class="spinner-border text-success" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </section>

    <!-- Modal content -->
    <section>
      <div class="modal fade" id="mealDetailModal" tabindex="-1" aria-labelledby="mealDetailModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="mealDetailModalLabel"></h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div id="meal-details" class="modal-body">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>
  <script src="js/app.js"></script>

  <script>
    const loadMeals = async (searchText, dataLimit) => {
      const url = `https://www.themealdb.com/api/json/v1/1/search.php?f=${searchText}`;
      const res = await fetch(url);
      const data = await res.json();
      displayMeals(data.meals, dataLimit);
    };

    const displayMeals = (meals, dataLimit) => {
      const mealsContainer = document.getElementById('meals-container');
      mealsContainer.textContent = '';
      
      const showAll = document.getElementById('show-all');
      if (dataLimit && meals && meals.length > 6) {
        meals = meals.slice(0, 6);
        showAll.classList.remove('d-none');
      } else {
        showAll.classList.add('d-none');
      }

      const noMeal = document.getElementById('no-found-message');
      if (!meals || meals.length === 0) {
        noMeal.classList.remove('d-none');
      } else {
        noMeal.classList.add('d-none');
      }

      meals.forEach(meal => {
        const mealDiv = document.createElement('div');
        mealDiv.classList.add('col');
        mealDiv.innerHTML = `
          <div class="card">
            <img src="${meal.strMealThumb}" class="card-img-top p-4" alt="${meal.strMeal}">
            <div class="card-body">
              <h5 class="card-title">${meal.strMeal}</h5>
              <p class="card-text">${meal.strInstructions.substring(0, 100)}...</p>
              <button onclick="loadMealDetails(${meal.idMeal})" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#mealDetailModal">Show Details</button>
            </div>
          </div>`;
        mealsContainer.appendChild(mealDiv);
      });

      toggleSpinner(false);
    };

    const processSearch = (dataLimit) => {
      toggleSpinner(true);
      const searchField = document.getElementById('search-field');
      const searchText = searchField.value;
      loadMeals(searchText, dataLimit);
    };

    document.getElementById('btn-search').addEventListener('click', function () {
      processSearch(6);
    });

    document.getElementById('search-field').addEventListener('keypress', function (event) {
      if (event.key === 'Enter') {
        processSearch(6);
      }
    });

    const toggleSpinner = isLoading => {
      const loaderSection = document.getElementById('loader');
      if (isLoading) {
        loaderSection.classList.remove('d-none');
      } else {
        loaderSection.classList.add('d-none');
      }
    };

    document.getElementById('btn-show-all').addEventListener('click', function () {
      processSearch();
    });

    const loadMealDetails = async (id) => {
      const url = `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`;
      const res = await fetch(url);
      const data = await res.json();
      displayMealDetails(data.meals[0]);
    };

    const displayMealDetails = meal => {
    console.log(meal);
    const modalTitle = document.getElementById('mealDetailModalLabel');
    modalTitle.innerText = meal.strMeal;

    const mealDetails = document.getElementById('meal-details');
    
    // Prepare the list of ingredients and measures
    let ingredientsList = '';
    for (let i = 1; i <= 20; i++) {
        const ingredient = meal[`strIngredient${i}`];
        const measure = meal[`strMeasure${i}`];
        if (ingredient && ingredient.trim() !== "") {
            ingredientsList += `<li>${measure} ${ingredient}</li>`;
        }
    }

    mealDetails.innerHTML = `
        <p><strong>Category:</strong> ${meal.strCategory}</p>
        <p><strong>Area:</strong> ${meal.strArea}</p>
        <p><strong>Instructions:</strong> ${meal.strInstructions}</p>
        <h5>Ingredients:</h5>
        <ul>
            ${ingredientsList}
        </ul>
        <img src="${meal.strMealThumb}" alt="${meal.strMeal}" class="img-fluid mt-3">
        <p><strong>Source:</strong> <a href="${meal.strSource}" target="_blank">Recipe Link</a></p>
        <p><strong>YouTube:</strong> <a href="${meal.strYoutube}" target="_blank">Watch Video</a></p>
    `;
};

  </script>

</body>

</html>
